CREATE OR REPLACE PROCEDURE SFDB_D_ICR_DEP_DW.ODS_DEP_DW.INSERT_TO_MANAGER(
    INPUT_CLAIM_ID STRING   -- e.g., 'CLM0001,CLM0002'
)
RETURNS STRING
LANGUAGE SQL
AS
$$
DECLARE
    inserted_count NUMBER;
BEGIN
    -- Insert matching claims into CLAIMS_MANAGER
    INSERT INTO SFDB_D_ICR_DEP_DW.ODS_DEP_DW.CLAIMS_MANAGER_REQUEST (
        CEID, CLIENT_ID, CLIENT, CLAIM_TYPE, FUND_ID, 
        CUSTODY_ACCOUNT_NO, CUSTODIAN_NAME, CLAIM_DATE, 
        CLAIM_ENG_GEN_DATE, CLAIM_ENG_GEN_TIME, AGE, 
        AGE_SETTLEMENT, INITIATOR, LOCAL_AMOUNT, 
        LOCAL_CURRENCY, AMOUNT_TOTAL_USD, STATUS, 
        AGE_OF_CLAIM, LIABLE_PARTY, LIABLE_PARTY_SUGGESTION, 
        LIABLE_PARTY_CONTACT, LIABLE_PARTY_ESCALATION_CONTACT, 
        LATEST_COMMENTS, KINGFIELD_COMMENT, LAST_ACTIONED_DATE, 
        NEXT_ACTION_DATE, ACTUAL_SETTLEMENT_DATE, REFERENCE_SOURCE, 
        NEXT_OWNER, AMOUNT_CATEGORY_USD_EQ, AGE_CATEGORY, 
        CLAIMS_ANALYST, CLAIMS_MANAGER, UPDATED_USER, 
        EXCEPTION_CODE, UPDATED_TIME, RECEIVED_MODE, 
        CLAIM_SOURCE, ERROR_MESSAGE
    )
    SELECT 
        CEID, CLIENT_ID, CLIENT, CLAIM_TYPE, FUND_ID, 
        CUSTODY_ACCOUNT_NO, CUSTODIAN_NAME, CLAIM_DATE, 
        CLAIM_ENG_GEN_DATE, CLAIM_ENG_GEN_TIME, AGE, 
        AGE_SETTLEMENT, INITIATOR, LOCAL_AMOUNT, 
        LOCAL_CURRENCY, AMOUNT_TOTAL_USD, 'NEW',   -- set STATUS to 'NEW'
        AGE_OF_CLAIM, LIABLE_PARTY, LIABLE_PARTY_SUGGESTION, 
        LIABLE_PARTY_CONTACT, LIABLE_PARTY_ESCALATION_CONTACT, 
        LATEST_COMMENTS, KINGFIELD_COMMENT, LAST_ACTIONED_DATE, 
        NEXT_ACTION_DATE, ACTUAL_SETTLEMENT_DATE, REFERENCE_SOURCE, 
        NEXT_OWNER, AMOUNT_CATEGORY_USD_EQ, AGE_CATEGORY, 
        CLAIMS_ANALYST, CLAIMS_MANAGER, UPDATED_USER, 
        EXCEPTION_CODE, CURRENT_TIMESTAMP, RECEIVED_MODE, 
        CLAIM_SOURCE, ERROR_MESSAGE
    FROM SFDB_D_ICR_DEP_DW.ODS_DEP_DW.CLAIMS_MASTER
    WHERE CEID IN (
        SELECT VALUE
        FROM TABLE(FLATTEN(SPLIT(:INPUT_CLAIM_ID, ',')))
    );

    -- Count inserted rows
    GET DIAGNOSTICS inserted_count = ROW_COUNT;

    RETURN 'Inserted ' || inserted_count || ' claims into CLAIMS_MANAGER';
END;
$$;
